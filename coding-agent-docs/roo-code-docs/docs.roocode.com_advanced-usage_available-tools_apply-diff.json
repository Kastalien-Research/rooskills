{
  "markdown": "Get comprehensive, actionable reviews directly in your PRs. [Try Roo's PR Reviewer](https://roocode.com/reviewer?utm_source=docs&utm_medium=banner&utm_campaign=reviewer_promo)\n\n[Skip to main content](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#__docusaurus_skipToContent_fallback)\n\n[![Roo Code Logo](https://docs.roocode.com/img/roo-code-logo-dark.png)](https://docs.roocode.com/)\n\n`ctrl`  `K`\n\n[Reddit](https://www.reddit.com/r/RooCode/ \"Reddit\")[Discord](https://discord.gg/roocode \"Discord\")\n\n[20.3k](https://github.com/RooCodeInc/Roo-Code \"GitHub Repository\") [Install ·934.6k](https://marketplace.visualstudio.com/items?itemName=RooVeterinaryInc.roo-cline \"Install VS Code Extension\")\n\n- [Welcome](https://docs.roocode.com/)\n- [Getting Started](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n- [Tutorial Videos](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n- [Roo Code Cloud](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n- Features\n\n  - [API Configuration Profiles](https://docs.roocode.com/features/api-configuration-profiles)\n  - [Auto-Approving Actions](https://docs.roocode.com/features/auto-approving-actions)\n  - [Boomerang Tasks](https://docs.roocode.com/features/boomerang-tasks)\n  - [Browser Use](https://docs.roocode.com/features/browser-use)\n  - [Checkpoints](https://docs.roocode.com/features/checkpoints)\n  - [Code Actions](https://docs.roocode.com/features/code-actions)\n  - [Codebase Indexing](https://docs.roocode.com/features/codebase-indexing)\n  - [Custom Instructions](https://docs.roocode.com/features/custom-instructions)\n  - [Diagnostics Integration](https://docs.roocode.com/features/diagnostics-integration)\n  - [Customizing Modes](https://docs.roocode.com/features/custom-modes)\n  - [Diff/Fast Edits](https://docs.roocode.com/features/fast-edits)\n  - [Enhance Prompt](https://docs.roocode.com/features/enhance-prompt)\n  - [Import/Export/Reset Settings](https://docs.roocode.com/features/settings-management)\n  - [Intelligent Context Condensing](https://docs.roocode.com/features/intelligent-context-condensing)\n  - [Keyboard Navigation](https://docs.roocode.com/features/keyboard-shortcuts)\n  - [Roo Code Marketplace](https://docs.roocode.com/features/marketplace)\n  - [Message Queueing](https://docs.roocode.com/features/message-queueing)\n  - [Model Temperature](https://docs.roocode.com/features/model-temperature)\n  - [Multi-File Reads](https://docs.roocode.com/features/concurrent-file-reads)\n  - [.rooignore](https://docs.roocode.com/features/rooignore)\n  - [Slash Commands](https://docs.roocode.com/features/slash-commands)\n  - [Suggested Responses](https://docs.roocode.com/features/suggested-responses)\n  - [Task Todo List](https://docs.roocode.com/features/task-todo-list)\n  - [Terminal Shell Integration](https://docs.roocode.com/features/shell-integration)\n  - [MCP](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n  - [Experimental](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n  - [Additional Features](https://docs.roocode.com/features/more-features)\n- [Advanced Usage](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n  - [Available Tools](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n    - [Tool Use Overview](https://docs.roocode.com/advanced-usage/available-tools/tool-use-overview)\n    - [access\\_mcp\\_resource](https://docs.roocode.com/advanced-usage/available-tools/access-mcp-resource)\n    - [apply\\_diff](https://docs.roocode.com/advanced-usage/available-tools/apply-diff)\n    - [ask\\_followup\\_question](https://docs.roocode.com/advanced-usage/available-tools/ask-followup-question)\n    - [attempt\\_completion](https://docs.roocode.com/advanced-usage/available-tools/attempt-completion)\n    - [browser\\_action](https://docs.roocode.com/advanced-usage/available-tools/browser-action)\n    - [codebase\\_search](https://docs.roocode.com/advanced-usage/available-tools/codebase-search)\n    - [execute\\_command](https://docs.roocode.com/advanced-usage/available-tools/execute-command)\n    - [insert\\_content](https://docs.roocode.com/advanced-usage/available-tools/insert-content)\n    - [list\\_code\\_definition\\_names](https://docs.roocode.com/advanced-usage/available-tools/list-code-definition-names)\n    - [list\\_files](https://docs.roocode.com/advanced-usage/available-tools/list-files)\n    - [new\\_task](https://docs.roocode.com/advanced-usage/available-tools/new-task)\n    - [read\\_file](https://docs.roocode.com/advanced-usage/available-tools/read-file)\n    - [run\\_slash\\_command](https://docs.roocode.com/advanced-usage/available-tools/run-slash-command)\n    - [search\\_files](https://docs.roocode.com/advanced-usage/available-tools/search-files)\n    - [search\\_and\\_replace](https://docs.roocode.com/advanced-usage/available-tools/search-and-replace)\n    - [switch\\_mode](https://docs.roocode.com/advanced-usage/available-tools/switch-mode)\n    - [update\\_todo\\_list](https://docs.roocode.com/advanced-usage/available-tools/update-todo-list)\n    - [use\\_mcp\\_tool](https://docs.roocode.com/advanced-usage/available-tools/use-mcp-tool)\n    - [write\\_to\\_file](https://docs.roocode.com/advanced-usage/available-tools/write-to-file)\n  - [Context Poisoning](https://docs.roocode.com/advanced-usage/context-poisoning)\n  - [Working with Large Projects](https://docs.roocode.com/advanced-usage/large-projects)\n  - [Using Local Models](https://docs.roocode.com/advanced-usage/local-models)\n  - [Local Development Setup](https://docs.roocode.com/advanced-usage/local-development-setup)\n  - [Prompt Engineering Tips](https://docs.roocode.com/advanced-usage/prompt-engineering)\n  - [Prompt Structure](https://docs.roocode.com/advanced-usage/prompt-structure)\n  - [Rate Limits and Costs](https://docs.roocode.com/advanced-usage/rate-limits-costs)\n  - [Footgun Prompting](https://docs.roocode.com/advanced-usage/footgun-prompting)\n  - [Roo Code Nightly](https://docs.roocode.com/advanced-usage/roo-code-nightly)\n- [Model Providers](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n- [FAQ](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n- [Contributing (GitHub)](https://github.com/RooCodeInc/Roo-Code/blob/main/CONTRIBUTING.md)\n- [Roocabulary (GitHub)](https://github.com/cannuri/Roocabulary)\n- [Update Notes](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#)\n\n\n- [Home page](https://docs.roocode.com/)\n- Advanced Usage\n- Available Tools\n- apply\\_diff\n\nCopy Page\n\nOn this page\n\n# apply\\_diff\n\nThe `apply_diff` tool makes precise, surgical changes to files by specifying exactly what content to replace. It uses a sophisticated strategy for finding and applying changes while maintaining proper code formatting and structure.\n\n* * *\n\n## Parameters [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#parameters \"Direct link to Parameters\")\n\nThe tool accepts these parameters:\n\n- `path` (required): The path of the file to modify relative to the current working directory.\n- `diff` (required): The search/replace block defining the changes using a format specific to the active diff strategy.\n- `start_line` (optional): A hint for where the search content begins. _Note: This top-level parameter appears unused by the current main strategy, which relies on `:start_line:` within the diff content._\n- `end_line` (optional): A hint for where the search content ends. _Note: This top-level parameter appears unused by the current main strategy._\n\n* * *\n\n## What It Does [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#what-it-does \"Direct link to What It Does\")\n\nThis tool applies targeted changes to existing files using fuzzy matching guided by line number hints to locate and replace content precisely. Unlike simple search and replace, it identifies the exact block for replacement based on the provided content and location hints.\n\n* * *\n\n## When is it used? [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#when-is-it-used \"Direct link to When is it used?\")\n\n- When Roo needs to make precise changes to existing code without rewriting entire files.\n- When refactoring specific sections of code while maintaining surrounding context.\n- When fixing bugs in existing code with surgical precision.\n- When implementing feature enhancements that modify only certain parts of a file.\n\n* * *\n\n## Key Features [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#key-features \"Direct link to Key Features\")\n\n- Uses fuzzy matching (Levenshtein distance on normalized strings) guided by a `:start_line:` hint, with configurable confidence thresholds (typically 0.8-1.0).\n- Provides context around matches using `BUFFER_LINES` (default 40).\n- Performs a middle-out search within a configurable context window ( `bufferLines`) around the hinted start line.\n- Preserves code formatting and indentation passively by replacing exact blocks.\n- Shows changes in a diff view for user review and editing before applying.\n- Tracks consecutive errors per file ( `consecutiveMistakeCountForApplyDiff`) to prevent repeated failures.\n- Validates file access against `.rooignore` rules.\n- Handles multi-line edits effectively.\n\n* * *\n\n## Limitations [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#limitations \"Direct link to Limitations\")\n\n- Works best with unique, distinctive code sections for reliable identification.\n- Performance can vary with very large files or highly repetitive code patterns.\n- Fuzzy matching might occasionally select incorrect locations if content is ambiguous.\n- Each diff strategy has specific format requirements.\n- Complex edits might require careful strategy selection or manual review.\n\n* * *\n\n## How It Works [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#how-it-works \"Direct link to How It Works\")\n\nWhen the `apply_diff` tool is invoked, it follows this process:\n\n1. **Parameter Validation**: Validates required `path` and `diff` parameters.\n2. **RooIgnore Check**: Validates if the target file path is allowed by `.rooignore` rules.\n3. **File Analysis**: Loads the target file content.\n4. **Match Finding**: Uses a fuzzy matching algorithm (Levenshtein on normalized strings) guided by the `:start_line:` hint within a context window ( `BUFFER_LINES`), searching middle-out to locate the target content based on the confidence threshold.\n5. **Change Preparation**: Generates the proposed changes by replacing the identified block.\n6. **User Interaction**:\n   - Displays the changes in a diff view.\n   - Allows the user to review and potentially edit the proposed changes.\n   - Waits for user approval or rejection.\n7. **Change Application**: If approved, applies the changes (potentially including user edits) to the file.\n8. **Error Handling**: If errors occur (e.g., match failure, partial application), increments the `consecutiveMistakeCountForApplyDiff` for the file and reports the failure type.\n9. **Feedback**: Returns the result, including any user feedback or error details.\n\n* * *\n\n## Diff Format Requirements [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#diff-format-requirements \"Direct link to Diff Format Requirements\")\n\nThe `<diff>` parameter requires a specific format supporting one or more changes in a single request. Each change block requires a line number hint for the original content.\n\n- **Requires**: Exact match for the `SEARCH` block content (within the fuzzy threshold), including whitespace and indentation. The `:start_line:` number hint is mandatory within each block. The `:end_line:` hint is optional (but supported by the parser). Markers like `<<<<<<<` within the file's content must be escaped ( `\\\\`) in the SEARCH block.\n\nExample format for the `<diff>` block:\n\n```codeBlockLines_e6Vv\n<<<<<<< SEARCH\n:start_line:10\n:end_line:12\n-------\n    // Old calculation logic\n    const result = value * 0.9;\n    return result;\n=======\n    // Updated calculation logic with logging\n    console.log(`Calculating for value: ${value}`);\n    const result = value * 0.95; // Adjusted factor\n    return result;\n>>>>>>> REPLACE\n\n<<<<<<< SEARCH\n:start_line:25\n:end_line:25\n-------\n    const defaultTimeout = 5000;\n=======\n    const defaultTimeout = 10000; // Increased timeout\n>>>>>>> REPLACE\n\n```\n\n* * *\n\n## Experimental: Multi-File Edits ( `MULTI_FILE_APPLY_DIFF`) [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#experimental-multi-file-edits-multi_file_apply_diff \"Direct link to experimental-multi-file-edits-multi_file_apply_diff\")\n\nAn experimental version of `apply_diff` allows for applying changes to multiple files within a single tool call. This feature is activated by the `MULTI_FILE_APPLY_DIFF` experiment flag.\n\n### Key Features of Experimental Mode [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#key-features-of-experimental-mode \"Direct link to Key Features of Experimental Mode\")\n\n- **Multi-File Operations**: Edit multiple files in one request, streamlining complex refactoring tasks.\n- **Batch Approval UI**: When multiple files are targeted, a single UI appears for the user to approve or deny all changes at once, or manage permissions for each file individually.\n- **New XML Format**: Introduces a new, more structured XML format using `<args>` and `<file>` tags to handle multiple operations.\n- **Backward Compatibility**: The experimental tool remains compatible with the legacy single-file `path` and `diff` parameter format.\n\n### How It Works (Experimental) [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#how-it-works-experimental \"Direct link to How It Works (Experimental)\")\n\n1. **Experiment Check**: The tool first checks if the `MULTI_FILE_APPLY_DIFF` experiment is enabled. If not, it falls back to the legacy `apply_diff` implementation.\n2. **Parameter Parsing**: It parses the new `<args>` XML format to identify all target files and their corresponding diff operations. It can also handle the legacy `path`/ `diff` parameters.\n3. **Validation and Approval**:\n   - It validates that all target files exist and are accessible (not blocked by `.rooignore`).\n   - If multiple files are being modified, it presents a **batch approval** dialog to the user.\n4. **Diff Application**: For each approved file, it applies the specified diffs using the `MultiFileSearchReplaceDiffStrategy`. This strategy can apply multiple, non-overlapping changes to a single file.\n5. **Results**: It returns a consolidated result message summarizing the outcome for all attempted operations.\n\n### New Diff Format (Experimental) [​](https://docs.roocode.com/advanced-usage/available-tools/apply-diff\\#new-diff-format-experimental \"Direct link to New Diff Format (Experimental)\")\n\nThe experimental mode uses a new XML structure within the `<apply_diff>` tool call.\n\n- **`<args>`**: A container for all file operations.\n- **`<file>`**: A block for each file to be modified. Contains `<path>` and one or more `<diff>` tags.\n- **`<path>`**: The relative path to the file.\n- **`<diff>`**: A block containing the change.\n  - **`<content>`**: The `SEARCH/REPLACE` block.\n  - **`<start_line>`**: (Optional) A line number hint.\n\n**Example: Modifying two files in one call**\n\n```codeBlockLines_e6Vv\n<apply_diff>\n  <args>\n    <file>\n      <path>src/services/auth.service.ts</path>\n      <diff>\n        <content>\n<<<<<<< SEARCH\n:start_line:50\n-------\n    const token_expiration = '15m';\n>>>>>>> REPLACE\n        </content>\n      </diff>\n    </file>\n    <file>\n      <path>src/config/auth.config.ts</path>\n      <diff>\n        <content>\n<<<<<<< SEARCH\n:start_line:12\n-------\n    rateLimit: 5,\n=======\n    rateLimit: 10,\n>>>>>>> REPLACE\n        </content>\n      </diff>\n    </file>\n  </args>\n</apply_diff>\n\n```\n\n[Edit this page](https://github.com/RooCodeInc/Roo-Code-Docs/edit/main/docs/advanced-usage/available-tools/apply-diff.md)\n\nLast updated on **Oct 3, 2025**\n\n[Previous\\\\\n\\\\\naccess\\_mcp\\_resource](https://docs.roocode.com/advanced-usage/available-tools/access-mcp-resource) [Next\\\\\n\\\\\nask\\_followup\\_question](https://docs.roocode.com/advanced-usage/available-tools/ask-followup-question)\n\n- [Parameters](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#parameters)\n- [What It Does](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#what-it-does)\n- [When is it used?](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#when-is-it-used)\n- [Key Features](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#key-features)\n- [Limitations](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#limitations)\n- [How It Works](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#how-it-works)\n- [Diff Format Requirements](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#diff-format-requirements)\n- [Experimental: Multi-File Edits ( `MULTI_FILE_APPLY_DIFF`)](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#experimental-multi-file-edits-multi_file_apply_diff)\n  - [Key Features of Experimental Mode](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#key-features-of-experimental-mode)\n  - [How It Works (Experimental)](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#how-it-works-experimental)\n  - [New Diff Format (Experimental)](https://docs.roocode.com/advanced-usage/available-tools/apply-diff#new-diff-format-experimental)\n\n![Roo Code Logo](https://docs.roocode.com/img/roo-code-logo-dark.png)\n\nEmpowering developers to build better software faster with AI-powered tools and insights.\n\n[GitHub](https://github.com/RooCodeInc/Roo-Code)[Discord](https://discord.gg/roocode)[Reddit](https://www.reddit.com/r/RooCode/)[X (Twitter)](https://x.com/roo_code)[LinkedIn](https://www.linkedin.com/company/roo-code)[TikTok](https://www.tiktok.com/@roo.code)[Bluesky](https://bsky.app/profile/roocode.bsky.social)\n\nGitHub\n\n- [Issues](https://github.com/RooCodeInc/Roo-Code/issues)\n- [Feature Requests](https://github.com/RooCodeInc/Roo-Code/discussions/categories/feature-requests?discussions_q=is%3Aopen+category%3A%22Feature+Requests%22+sort%3Atop)\n\nDownload\n\n- [VS Code Marketplace](https://marketplace.visualstudio.com/items?itemName=RooVeterinaryInc.roo-cline)\n- [Open VSX Registry](https://open-vsx.org/extension/RooVeterinaryInc/roo-cline)\n\nCompany\n\n- [Contact](mailto:support@roocode.com)\n- [Careers](https://careers.roocode.com/)\n- [Website Privacy Policy](https://roocode.com/privacy)\n- [Extension Privacy Policy](https://github.com/RooCodeInc/Roo-Code/blob/main/PRIVACY.md)\n\nLike most of the internet, we use cookies. Are you OK with that?\n\nDeclineAccept",
  "metadata": {
    "generator": "Docusaurus v3.9.2",
    "docsearch:language": "en",
    "ogTitle": "apply_diff | Roo Code Documentation",
    "twitter:site": "@roo_code",
    "viewport": "width=device-width, initial-scale=1.0",
    "ogLocale": "en_US",
    "description": "Master the apply_diff tool for making surgical code changes using fuzzy matching and line hints in Roo Code with multi-file support.",
    "ogUrl": "https://docs.roocode.com/advanced-usage/available-tools/apply-diff",
    "favicon": "https://docs.roocode.com/img/favicon.ico",
    "docsearch:version": "current",
    "docsearch:docusaurus_tag": "docs-default-current",
    "og:title": "apply_diff | Roo Code Documentation",
    "og:description": "Master the apply_diff tool for making surgical code changes using fuzzy matching and line hints in Roo Code with multi-file support.",
    "title": "apply_diff | Roo Code Documentation",
    "language": "en",
    "twitter:creator": "@roo_code",
    "og:url": "https://docs.roocode.com/advanced-usage/available-tools/apply-diff",
    "ogImage": "https://docs.roocode.com/img/social-share.jpg",
    "docusaurus_locale": "en",
    "twitter:card": "summary_large_image",
    "docusaurus_version": "current",
    "og:type": "website",
    "docusaurus_tag": "docs-default-current",
    "og:image": "https://docs.roocode.com/img/social-share.jpg",
    "og:locale": "en_US",
    "twitter:image": "https://docs.roocode.com/img/social-share.jpg",
    "keywords": "apply_diff,file editing,code modifications,fuzzy matching,diff tool,Roo Code tools,multi-file edits",
    "ogDescription": "Master the apply_diff tool for making surgical code changes using fuzzy matching and line hints in Roo Code with multi-file support.",
    "scrapeId": "0ca53204-de39-455d-b80e-047db43be23f",
    "sourceURL": "https://docs.roocode.com/advanced-usage/available-tools/apply-diff",
    "url": "https://docs.roocode.com/advanced-usage/available-tools/apply-diff",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "miss",
    "creditsUsed": 1
  }
}